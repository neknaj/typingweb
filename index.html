<!DOCTYPE html>
<html>
    <head>
        <title>Neknaj Typing Web</title>
        <meta charset="utf*8">
        <meta property="og:title" content="Neknaj Typing Web">
        <meta property="og:description" content="typing software for web">
        <meta property="description" content="typing software for web">
        <link rel="stylesheet" href="layout.css">
        <script src="layout.js"></script>
        <script src="typing.js"></script>
        <script src="cdom.js"></script>
    </head>
    <body>
        <div class="resizer_Hcontainer" id="mainarea" data-proportion="5:2">
            <div class="resizer_content">
                <div class="resizer_Vcontainer" data-proportion="4:1">
                    <div class="resizer_content">
                        <div id="playArea">
                            <div id="Ques"></div>
                            <div id="Input"></div>
                        </div>
                    </div>
                    <div class="resizer_splitter"></div>
                    <div class="resizer_content">
                    </div>
                </div>
            </div>
            <div class="resizer_splitter"></div>
            <div class="resizer_content">
                <div class="resizer_Vcontainer" data-proportion="5:2">
                    <div class="resizer_content">
                    </div>
                    <div class="resizer_splitter"></div>
                    <div class="resizer_content">
                    </div>
                </div>
            </div>
        </div>
    </body>
</html>
<script>module={}</script>
<script src="./ntq.js"></script>
<script>const ntqparser = module.exports.parse;</script>
<script>

var typing;

window.onload = init;
async function init() {
    res = loadntq("question/1.ntq");
    keyboard = JSON.parse(fRead("keyboard.json"))
    typing = new Typing(res[0],keyboard);
    updateView();
};

function loadntq(filename) {
    const _data = fRead(filename).replace(/\r\n/g,"\n").split("\n");
    const res = [];
    for (const i of _data) {
        console.log(i)
        if (i[0]=="#") {continue}
        res.push(ntqparser(i));
    }
    console.log(res)
    // for (const i of res) {
    //     console.table(i)
    // }
    for (const i of res) {
        console.table(i.map((i)=>{return i.map((x)=>{if(x instanceof Array){return x.join(", ")};return x})}))
    }
    return res;
}


function fRead(filename) {
    var hr = new XMLHttpRequest();
    hr.open("GET", filename, false);
    hr.send(null);
    if (hr.status == 200 || hr.status == 304) {
        return hr.responseText.replace(/\r\n/g, "\n");
    }else {throw "err " + filename;}
};

function updateView() {
    Ques.replaceChildren(typing.getQuesView());
    Input.replaceChildren(typing.getInputView());
}

</script>
<script>
</script>
<script>

document.addEventListener("keydown",(e)=>{
    console.log("keydown",e.key)
    typing.key(e.key);
    updateView();
},false);


</script>
<style>
    @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@200&display=swap');
</style>
<style>
    * {
        font-family: "Noto Sans JP", sans-serif;
        font-optical-sizing: auto;
        font-style: normal;
        font-size: 110%;
    }
    body {
        background-color: rgb(0, 2, 10);
        color: white;
        position: fixed;
        padding: 0;
        margin: 0;
    }
    #imgOutArea {
        height: 100%;
        width: 100%;
        overflow: auto;
        position: relative;
        padding: 0;
        margin: 0;
    }
    #imgOutArea>canvas {
        cursor: crosshair;
        touch-action: none;
        position: absolute;
        left: 10px;
        top: 10px;
        transform-origin: top left;
        background-color: rgba(255, 255, 255, 0.3);
    }
    #mainarea {
        height: 100dvh;
        width: 100dvw;
    }
    
    #playArea {
        & #Ques {
            & rt {
                font-size: 20px;
                color: rgb(255, 255, 255);
                & .s1 {
                    color: rgb(255, 255, 255);
                }
                & .s2 {
                    color: rgb(255, 173, 173);
                }
                & .s3 {
                    color: rgb(164, 164, 255);
                }
                & .s4 {
                    color: rgb(255, 132, 132);
                }
            }
            & rb, & .noruby {
                font-size: 50px;
                color: rgb(255, 255, 255);
                &.s1 {
                    color: rgb(255, 255, 255);
                }
                &.s2 {
                    color: rgb(255, 173, 173);
                }
                &.s3 {
                    color: rgb(164, 164, 255);
                }
                &.s4 {
                    color: rgb(255, 132, 132);
                }
            }
        }
        & #Input span {
            font-size: 50px;
            color: rgb(255, 255, 255);
            &.s3 {
                color: rgb(164, 164, 255);
            }
            &.s4 {
                color: rgb(255, 132, 132);
            }
        }
    }
    
    #playArea {
        position: relative;
        height: 100%;
        &>div#Ques {
            position: absolute;
            top: calc(50% - 50.5px - 70px);
            left: 40px;
        }
        &>div#Input {
            position: absolute;
            top: calc(50% - 50.5px + 70px);
            left: 40px;
        }
    }
</style>